!function(){"use strict";var e="undefined"!=typeof window?window:globalThis;if("function"!=typeof e.Chess||"function"!=typeof e.Chessboard)return;document.addEventListener("DOMContentLoaded",function(){var e=[].slice.call(document.querySelectorAll("puzzle")),t=!1;e.forEach(function(e){if(e.__jcInit)return;e.__jcInit=!0;var n=(e.innerHTML||"").replace(/[â™”â™•â™–â™—â™˜â™™â™šâ™›â™œâ™â™â™Ÿ]/g,"").trim(),r=document.createElement("div");r.className="jc-puzzle-wrapper",e.replaceWith(r);var o=n.match(/FEN:\s*([^\n<]+)/i),a=n.match(/Moves:\s*([^\n<]+)/i),i=n.match(/PGN:\s*(https?:\/\/[^\s<]+)/i),s=!i&&n.match(/PGN:\s*(1\.[\s\S]+)/i);if(i&&!o){if(t)return void(r.textContent="âš ï¸ Only one remote PGN pack allowed per page.");t=!0,initRemote(r,i[1].trim())}else o&&s?renderLocal(r,o[1].trim(),parsePGN(s[1])):o&&a?renderLocal(r,o[1].trim(),a[1].trim().split(/\s+/)):r.textContent="âŒ Invalid <puzzle> block."})});function parsePGN(e){return e.replace(/\[[^\]]*]/g," ").replace(/\{[^}]*}/g," ").replace(/\([^)]*\)/g," ").replace(/\b\d+\.\.\./g," ").replace(/\b\d+\.(?:\.\.)?/g," ").replace(/\b(1-0|0-1|1\/2-1\/2|\*)\b/g," ").replace(/\s+/g," ").trim().split(" ").filter(Boolean)}function normSAN(e){return(e||"").replace(/[+#?!]/g,"")}function renderLocal(e,t,n){var r=new Chess(t),o=r.turn(),a=0,i=!1,s=document.createElement("div");s.className="jc-board";var l=document.createElement("div");l.className="jc-status-row";var c=document.createElement("span");c.className="jc-turn";var d=document.createElement("span");d.className="jc-feedback",l.append(c,d),e.append(s,l);var u=Chessboard(s,{draggable:!0,position:t,pieceTheme:"https://chessboardjs.com/img/chesspieces/wikipedia/{piece}.png",onDrop:function(e,t){return play(e,t)||"snapback"}});function update(){c.textContent=i?"":("w"===r.turn()?"âš White to move":"âš‘ Black to move")}function sync(){u.position(r.fen(),!1)}function play(e,t){if(i||r.turn()!==o)return!1;var s=n[a],l=r.move({from:e,to:t,promotion:"q"});return l?normSAN(l.san)!==normSAN(s)?(r.undo(),sync(),d.textContent="Wrong move âŒ",update(),!1):(a++,sync(),d.textContent="Correct move âœ…",autoOpponent(),!0):!1}function autoOpponent(){if(a>=n.length)return i=!0,d.textContent="Puzzle solved ğŸ†",void update();if(r.turn()===o)return update();var e=n[a],t=r.move(e,{sloppy:!0});t?(a++,sync(),update()):(i=!0,d.textContent="Puzzle solved ğŸ†",update())}sync(),update()}function initRemote(e,t){var n=20,r=document.createElement("div");r.className="jc-board";var o=document.createElement("div");o.className="jc-status-row";var a=document.createElement("span");a.className="jc-turn";var i=document.createElement("span");i.className="jc-feedback";var s=document.createElement("span");s.className="jc-controls";var l=document.createElement("button");l.textContent="â†¶";var c=document.createElement("button");c.textContent="â†·",s.append(l,c),o.append(a,i,s),e.append(r,o),i.textContent="Loading puzzle packâ€¦";fetch(t).then(function(e){return e.text()}).then(function(e){var t=e.split(/\[Event\b/).slice(1).map(function(e){return"[Event"+e}),o=[],s=0,l=0,c,d,u,p,f=!1,g=new Chessboard(r,{draggable:!0,pieceTheme:"https://chessboardjs.com/img/chesspieces/wikipedia/{piece}.png",onDrop:function(e,t){return play(e,t)||"snapback"}});function sync(){g.position(c.fen(),!1)}function parse(){for(var e=Math.min(s+n,t.length);s<e;s++){var r=t[s].match(/\[FEN\s+"([^"]+)"/);if(r){var a=parsePGN(t[s]);a.length&&o.push({fen:r[1],moves:a})}}}function load(e){o[e]||(parse(),o[e])&&(l=e,c=new Chess(o[e].fen),d=o[e].moves,u=c.turn(),p=0,f=!1,sync(),i.textContent="",update())}function update(){a.textContent=f?"":("w"===c.turn()?"âš White to move":"âš‘ Black to move")}function play(e,t){if(f||c.turn()!==u)return!1;var r=d[p],o=c.move({from:e,to:t,promotion:"q"});return o?normSAN(o.san)!==normSAN(r)?(c.undo(),sync(),i.textContent="Wrong move âŒ",update(),!1):(p++,sync(),i.textContent="Correct move âœ…",autoOpponent(),!0):!1}function autoOpponent(){if(p>=d.length)return f=!0,i.textContent="Puzzle solved ğŸ†",void update();if(c.turn()===u)return update();var e=d[p],t=c.move(e,{sloppy:!0});t?(p++,sync(),update()):(f=!0,i.textContent="Puzzle solved ğŸ†",update())}l.onclick=function(){load(l-1)},c.onclick=function(){load(l+1)},parse(),load(0)}).catch(function(){i.textContent="âŒ Failed to load PGN."})}}();
