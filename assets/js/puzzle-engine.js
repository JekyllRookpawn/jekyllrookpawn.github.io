!function(){"use strict";var e="undefined"!=typeof window?window:globalThis;if("function"!=typeof e.Chess||"function"!=typeof e.Chessboard)return;document.addEventListener("DOMContentLoaded",function(){var e=[].slice.call(document.querySelectorAll("puzzle")),t=!1;e.forEach(function(e){if(e.__jcInit)return;e.__jcInit=!0;var n=(e.innerHTML||"").replace(/[â™”â™•â™–â™—â™˜â™™]/g,"").trim(),r=document.createElement("div");r.className="jc-puzzle-wrapper",e.replaceWith(r);var o=n.match(/FEN:\s*([^\n<]+)/i),a=n.match(/Moves:\s*([^\n<]+)/i),i=n.match(/PGN:\s*(https?:\/\/[^\s<]+)/i),s=!i&&n.match(/PGN:\s*(1\.[\s\S]+)/i);if(i&&!o){if(t)return void(r.textContent="âš ï¸ Only one remote PGN pack allowed per page.");t=!0,initRemote(r,i[1].trim())}else o&&s?renderLocal(r,o[1].trim(),parsePGN(s[1])):o&&a?renderLocal(r,o[1].trim(),a[1].trim().split(/\s+/)):r.textContent="âŒ Invalid <puzzle> block."})});function parsePGN(e){return e.replace(/\[[^\]]*]/g," ").replace(/\{[^}]*}/g," ").replace(/\([^)]*}/g," ").replace(/\b\d+\.\.\./g," ").replace(/\b\d+\.(?:\.\.)?/g," ").replace(/\b(1-0|0-1|1\/2-1\/2|\*)\b/g," ").replace(/\s+/g," ").trim().split(" ").filter(Boolean)}function normSAN(e){return(e||"").replace(/[+#?!]/g,"")}function solverIdx(e,t){return t.map(function(e,t){return t}).filter(function(e){return e%2==0})}function renderLocal(e,t,n){var r=new Chess(t),o=solverIdx(t,n).map(function(e){return n[e]}),a=0,i=0,s=!1,l=document.createElement("div");l.className="jc-board";var c=document.createElement("div");c.className="jc-status-row";var d=document.createElement("span");d.className="jc-turn";var u=document.createElement("span");u.className="jc-feedback",c.append(d,u),e.append(l,c);var p=Chessboard(l,{draggable:!0,position:t,pieceTheme:"https://chessboardjs.com/img/chesspieces/wikipedia/{piece}.png",onDrop:function(e,t){return play(e,t)||"snapback"}});function play(e,t){if(s)return!1;var n=r.move({from:e,to:t,promotion:"q"});return n?normSAN(n.san)!==normSAN(o[a])?(r.undo(),u.textContent="Wrong move âŒ",!1):(a++,u.textContent="Correct move âœ…",auto(),!0):!1}function auto(){if(a+i>=n.length)return s=!0,u.textContent="Puzzle solved ğŸ†",void(d.textContent="");var e=n[a+i],t=r.move(e,{sloppy:!0});t?(i++,p.position(r.fen(),!0),setTimeout(auto,250)):(s=!0,u.textContent="Puzzle solved ğŸ†")}d.textContent=r.turn()==="w"?"âš White to move":"âš‘ Black to move"}function initRemote(e,t){var n=20,r=document.createElement("div");r.className="jc-board";var o=document.createElement("div");o.className="jc-status-row";var a=document.createElement("span");a.className="jc-turn";var i=document.createElement("span");i.className="jc-feedback";var s=document.createElement("span");s.className="jc-controls";var l=document.createElement("button");l.textContent="â†¶";var c=document.createElement("button");c.textContent="â†·",s.append(l,c),o.append(a,i,s),e.append(r,o),i.textContent="Loading puzzle packâ€¦";fetch(t).then(function(e){return e.text()}).then(function(e){var t=e.split(/\[Event\b/).slice(1).map(function(e){return"[Event"+e}),o=[],s=0,l=0,c,d,u,p,f,g,y=new Chessboard(r,{draggable:!0,pieceTheme:"https://chessboardjs.com/img/chesspieces/wikipedia/{piece}.png",onDrop:function(e,t){return play(e,t)||"snapback"}});function parse(){for(var e=Math.min(s+n,t.length);s<e;s++){var r=t[s].match(/\[FEN\s+"([^"]+)"/);if(r){var a=parsePGN(t[s]);a.length&&o.push({fen:r[1],moves:a})}}}function load(e){o[e]||(parse(),o[e])&&(l=e,c=new Chess(o[e].fen),d=o[e].moves,u=solverIdx(o[e].fen,d).map(function(e){return d[e]}),p=0,f=0,g=!1,y.position(c.fen()),i.textContent="",a.textContent=c.turn()==="w"?"âš White to move":"âš‘ Black to move")}function play(e,t){if(g)return!1;var n=c.move({from:e,to:t,promotion:"q"});return n?normSAN(n.san)!==normSAN(u[p])?(c.undo(),i.textContent="Wrong move âŒ",!1):(p++,i.textContent="Correct move âœ…",auto(),!0):!1}function auto(){if(p+f>=d.length)return g=!0,i.textContent="Puzzle solved ğŸ†",void(a.textContent="");var e=d[p+f],t=c.move(e,{sloppy:!0});t?(f++,y.position(c.fen(),!0),setTimeout(auto,250)):(g=!0,i.textContent="Puzzle solved ğŸ†")}l.onclick=function(){load(l-1)},c.onclick=function(){load(l+1)},parse(),load(0)}).catch(function(){i.textContent="âŒ Failed to load PGN."})}}();