!function(){"use strict";var e="undefined"!=typeof window?window:globalThis;if("function"!=typeof e.Chess||"function"!=typeof e.Chessboard)return;document.addEventListener("DOMContentLoaded",function(){var e=[].slice.call(document.querySelectorAll("puzzle")),t=!1;e.forEach(function(e){if(e.__jcInit)return;e.__jcInit=!0;var n=(e.innerHTML||"").replace(/[â™”â™•â™–â™—â™˜â™™â™šâ™›â™œâ™â™â™Ÿ]/g,"").trim(),r=document.createElement("div");r.className="jc-puzzle-wrapper",e.replaceWith(r);var o=n.match(/FEN:\s*([^\n<]+)/i),a=n.match(/Moves:\s*([^\n<]+)/i),i=n.match(/PGN:\s*(https?:\/\/[^\s<]+)/i),s=!i&&n.match(/PGN:\s*(1\.[\s\S]+)/i);if(i&&!o){if(t)return void(r.textContent="âš ï¸ Only one remote PGN pack allowed per page.");t=!0,initRemote(r,i[1].trim())}else o&&s?renderLocal(r,o[1].trim(),parsePGN(s[1])):o&&a?renderLocal(r,o[1].trim(),a[1].trim().split(/\s+/)):r.textContent="âŒ Invalid <puzzle> block."})});function parsePGN(e){return e.replace(/\[[^\]]*]/g," ").replace(/\{[^}]*}/g," ").replace(/\([^)]*\)/g," ").replace(/\b\d+\.\.\./g," ").replace(/\b\d+\.(?:\.\.)?/g," ").replace(/\b(1-0|0-1|1\/2-1\/2|\*)\b/g," ").replace(/\s+/g," ").trim().split(" ").filter(Boolean)}function normSAN(e){return(e||"").replace(/[+#?!]/g,"")}function renderLocal(e,t,n){var r=new Chess(t),o=r.turn(),a=0,i=!1,s=document.createElement("div");s.className="jc-board";var l=document.createElement("div");l.className="jc-status-row";var c=document.createElement("span");c.className="jc-turn";var d=document.createElement("span");d.className="jc-feedback",l.append(c,d),e.append(s,l);var u=Chessboard(s,{draggable:!0,position:t,pieceTheme:"https://chessboardjs.com/img/chesspieces/wikipedia/{piece}.png",onDrop:function(e,t){return play(e,t)||"snapback"}});function sync(){u.position(r.fen(),!1)}function update(){c.textContent=i?"":("w"===r.turn()?"âš White to move":"âš‘ Black to move")}function play(e,t){if(i||r.turn()!==o)return!1;var s=n[a],l=r.move({from:e,to:t,promotion:"q"});return l?normSAN(l.san)!==normSAN(s)?(r.undo(),sync(),d.textContent="Wrong move âŒ",update(),!1):(a++,sync(),d.textContent="Correct move âœ…",autoOpponent(),!0):!1}function autoOpponent(){if(a>=n.length)return i=!0,d.textContent="Puzzle solved ğŸ†",void update();if(r.turn()===o)return update();var e=n[a];setTimeout(function(){var t=r.move(e,{sloppy:!0});t?(a++,sync(),update()):(i=!0,d.textContent="Puzzle solved ğŸ†",update())},0)}sync(),update()}function initRemote(e,t){var n=document.createElement("div");n.className="jc-board";var r=document.createElement("div");r.className="jc-status-row";var o=document.createElement("span");o.className="jc-turn";var a=document.createElement("span");a.className="jc-feedback";var i=document.createElement("span");i.className="jc-controls";var s=document.createElement("span");s.className="jc-counter";var l=document.createElement("button");l.textContent="â†¶";var c=document.createElement("button");c.textContent="â†·",i.append(l,c),r.append(o,a,s,i),e.append(n,r),a.textContent="Loading puzzle packâ€¦";fetch(t).then(function(e){if(!e.ok)throw new Error("HTTP "+e.status);return e.text()}).then(function(e){var t=e.split(/\n\s*\n(?=\[|1\.)/),puzzles=[],puzzleIndex=0,moveIndex=0,chess=null,moves=null,solverSide=null,solved=!1,board=Chessboard(n,{draggable:!0,pieceTheme:"https://chessboardjs.com/img/chesspieces/wikipedia/{piece}.png",onDrop:function(e,t){return userMove(e,t)||"snapback"}});t.forEach(function(e){var t=e.match(/\[FEN\s+"([^"]+)"/);if(t){var n=parsePGN(e);n.length&&puzzles.push({fen:t[1],moves:n})}});if(!puzzles.length)return a.textContent="âŒ No puzzles found in PGN.";function sync(){board.position(chess.fen(),!1)}function update(){o.textContent=solved?"":("w"===chess.turn()?"âš White to move":"âš‘ Black to move"),s.textContent="Puzzle "+(puzzleIndex+1)+" / "+puzzles.length}function loadPuzzle(e){if(!puzzles[e])return;puzzleIndex=e,chess=new Chess(puzzles[e].fen),moves=puzzles[e].moves,solverSide=chess.turn(),moveIndex=0,solved=!1,sync(),a.textContent="",update()}function userMove(e,t){if(solved||chess.turn()!==solverSide)return!1;var n=moves[moveIndex],r=chess.move({from:e,to:t,promotion:"q"});return r?normSAN(r.san)!==normSAN(n)?(chess.undo(),sync(),a.textContent="Wrong move âŒ",update(),!1):(moveIndex++,sync(),a.textContent="Correct move âœ…",autoOpponent(),!0):!1}function autoOpponent(){if(moveIndex>=moves.length)return solved=!0,a.textContent="Puzzle solved ğŸ†",void update();if(chess.turn()===solverSide)return update();var e=moves[moveIndex];setTimeout(function(){var t=chess.move(e,{sloppy:!0});t?(moveIndex++,sync(),update()):(solved=!0,a.textContent="Puzzle solved ğŸ†",update())},0)}l.onclick=function(){loadPuzzle(puzzleIndex-1)},c.onclick=function(){loadPuzzle(puzzleIndex+1)},loadPuzzle(0)}).catch(function(e){console.error("PGN load failed:",e),a.textContent="âŒ Failed to load PGN ("+e.message+")"})}}();