!function(){"use strict";var e="undefined"!=typeof window?window:globalThis;if("function"!=typeof e.Chess||!e.PGNCore)return;var t=e.PGNCore,n=0,r="function"==typeof e.Chessboard;function a(e,a){if(!e||!a)return;var i="pgn-diagram-"+n++;try{var o=document.createElement("div");o.className="pgn-diagram",o.id=i,e.appendChild(o),r&&e.Chessboard?e.Chessboard(i,{position:a,draggable:!1,pieceTheme:t.PIECE_THEME_URL}):r&&Chessboard(i,{position:a,draggable:!1,pieceTheme:t.PIECE_THEME_URL})}catch(e){}}function i(e){return t.SAN_CORE_REGEX.test(e)}function o(e){var t=e.split(/\r?\n/),n=[],r=[],a=!0;for(var i=0;i<t.length;i++){var o=t[i],s=o.trim();a&&s.startsWith("[")&&s.endsWith("]")?n.push(o):a&&""===s?a=!1:(a=!1,r.push(o))}return{headers:n,moveText:r.join(" ").replace(/\s+/g," ").trim()}}function s(e,t,n){if(!t||!n)return n;for(var r=t;r<e.length&&"}"!==e[r];)r++;var i=e.substring(t,r).trim();"{"===e[t-1]&&"}"===e[r]&&(r+=1),i=i.replace(/\[%.*?]/g,"").trim();if(!i.length)return r;for(var o=i.split("[D]"),s=0;s<o.length;s++){var l=o[s].trim();if("variation"===n.type){c(this,n,"pgn-variation"),l&&u(n.container," "+l)}else{if(l){var p=document.createElement("p");p.className="pgn-comment",u(p,l),this.wrapper.appendChild(p)}n.container=null}s<o.length-1&&a(this.wrapper,n.chess.fen())}return n.lastWasInterrupt=!0,r}function c(e,t,n){t.container||(t.container=document.createElement("p"),t.container.className=n,e.wrapper.appendChild(t.container))}function u(e,t){if(e&&t&&"undefined"!=typeof document&&document.createTextNode)try{e.appendChild(document.createTextNode(String(t)))}catch(e){}}function l(e){this.sourceEl=e,this.wrapper=document.createElement("div"),this.wrapper.className="pgn-blog-block",this.finalResultPrinted=!1,this.build(),this.applyFigurines()}l.prototype.build=function(){var e="";try{e=this.sourceEl.textContent.trim()}catch(t){return}e=t.normalizeFigurines(e);var n=o(e),r=n.headers,a=n.moveText,s=(r.length?r.join("\n")+"\n\n":"")+a,c=new Chess;try{c.load_pgn(s,{sloppy:!0})}catch(e){}var u={};try{u=c.header?c.header():{}}catch(e){}var l=t.normalizeResult(u.Result||""),p=/ (1-0|0-1|1\/2-1\/2|½-½|\*)$/.test(a),d=p?a:a+(l?" "+l:"");this.header(u),this.parse(d);try{this.sourceEl.replaceWith(this.wrapper)}catch(e){}} ,l.prototype.header=function(e){var n=document.createElement("h3"),r=(e.WhiteTitle?e.WhiteTitle+" ":"")+t.flipName(e.White||"")+(e.WhiteElo?" ("+e.WhiteElo+")":""),a=(e.BlackTitle?e.BlackTitle+" ":"")+t.flipName(e.Black||"")+(e.BlackElo?" ("+e.BlackElo+")":""),i=t.extractYear(e.Date),o=(e.Event||"")+(i?", "+i:"");n.appendChild(document.createTextNode(r+" – "+a)),n.appendChild(document.createElement("br")),n.appendChild(document.createTextNode(o)),this.wrapper.appendChild(n)},l.prototype.handleSAN=function(e,n){var r=e.replace(/[^a-hKQRBN0-9=O0-]+$/g,"").replace(/0/g,"O");if(!i(r))return u(n.container,e+" "),null;var a=n.baseHistoryLen||0,o=n.chess.history().length,s=a+o,c=s%2==0,l=Math.floor(s/2)+1;c?u(n.container,l+"."+t.NBSP):n.lastWasInterrupt&&u(n.container,l+"..."+t.NBSP),n.prevFen=n.chess.fen(),n.prevHistoryLen=s;var p=null;try{p=n.chess.move(r,{sloppy:!0})}catch(e){}if(!p)return u(n.container,e+" "),null;n.lastWasInterrupt=!1;var d=document.createElement("span");return d.className="pgn-move",d.textContent=t.makeCastlingUnbreakable(e)+" ",n.container.appendChild(d),d},l.prototype.parse=function(e){var n=new Chess,r={type:"main",chess:n,container:null,parent:null,lastWasInterrupt:!1,prevFen:n.fen(),prevHistoryLen:0,baseHistoryLen:null},o=0;for(;o<e.length;){var l=e[o];if(/\s/.test(l)){for(;o<e.length&&/\s/.test(e[o]);)o++;c(this,r,"main"===r.type?"pgn-mainline":"pgn-variation"),u(r.container," ");continue}if("("===l){o++;var p=r.prevFen||r.chess.fen(),d="number"==typeof r.prevHistoryLen?r.prevHistoryLen:r.chess.history().length;r={type:"variation",chess:new Chess(p),container:null,parent:r,lastWasInterrupt:!0,prevFen:p,prevHistoryLen:d,baseHistoryLen:d},c(this,r,"pgn-variation");continue}if(")"===l){o++,r.parent&&(r=r.parent,r.lastWasInterrupt=!0,r.container=null);continue}if("{"===l){o=s.call(this,e,o+1,r);continue}for(var h=o;o<e.length&&!/\s/.test(e[o])&&-1==="(){}".indexOf(e[o]);)o++;var f=e.substring(h,o);if(!f)continue;if(/^\[%.*]$/.test(f))continue;if("[D]"===f){a(this.wrapper,r.chess.fen()),r.lastWasInterrupt=!0,r.container=null;continue}if(t.RESULT_REGEX.test(f)){this.finalResultPrinted||(this.finalResultPrinted=!0,c(this,r,"main"===r.type?"pgn-mainline":"pgn-variation"),u(r.container,f+" "));continue}if(t.MOVE_NUMBER_REGEX.test(f))continue;var v=f.replace(/[^a-hKQRBN0-9=O0-]+$/g,"").replace(/0/g,"O"),m=i(v);if(!m){if(t.EVAL_MAP[f]){c(this,r,"main"===r.type?"pgn-mainline":"pgn-variation"),u(r.container,t.EVAL_MAP[f]+" ");continue}if("$"===f[0]){var g=+f.slice(1);t.NAG_MAP[g]&&(c(this,r,"main"===r.type?"pgn-mainline":"pgn-variation"),u(r.container,t.NAG_MAP[g]+" "));continue}if(/[A-Za-zÇĞİÖŞÜçğıöşü]/.test(f))if("variation"===r.type)c(this,r,"pgn-variation"),u(r.container," "+f);else{var y=document.createElement("p");y.className="pgn-comment",u(y,f),this.wrapper.appendChild(y),r.container=null,r.lastWasInterrupt=!1}else c(this,r,"main"===r.type?"pgn-mainline":"pgn-variation"),u(r.container,f+" ");continue}c(this,r,"main"===r.type?"pgn-mainline":"pgn-variation");var b=this.handleSAN(f,r);b||u(r.container,t.makeCastlingUnbreakable(f)+" ")}},l.prototype.applyFigurines=function(){if(this.wrapper.__pgnFigurined)return;this.wrapper.__pgnFigurined=!0;var e={K:"♔",Q:"♕",R:"♖",B:"♗",N:"♘"},t=this.wrapper.querySelectorAll(".pgn-move");t.forEach(function(t){var n=t.textContent.match(/^([KQRBN])(.+?)(\s*)$/);n&&(t.textContent=e[n[1]]+n[2]+(n[3]||""))})};var p={renderAll:function(e){(e||document).querySelectorAll("pgn").forEach(function(e){e.__pgnRendered||(e.__pgnRendered=!0,new l(e))})},init:function(){p.renderAll(document)}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){p.init()},{once:!0}):p.init()}();