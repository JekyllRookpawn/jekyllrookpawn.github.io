---
layout: none
title: PGN Viewer
pgn: |
  [Event "Demo Game"]
  [Site "Istanbul"]
  [Date "2025.12.16"]
  [Round "-"]
  [White "White Player"]
  [Black "Black Player"]
  [Result "1-0"]

  1. e4 {King's Pawn} e5
  2. Nf3 Nc6?!
  3. Bb5 a6
  4. Ba4 Nf6
  5. O-O Be7?!
  6. Re1 b5
  7. Bb3 d6
  8. c3 O-O
  9. h3 {A quiet move} 1-0
---
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>{{ page.title }}</title>

<!-- Libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.12.0/chess.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chessboard-js/1.0.0/chessboard-1.0.0.min.js"></script>
<link rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/chessboard-js/1.0.0/chessboard-1.0.0.min.css">

<style>
/* ---------- RESET ---------- */
* { box-sizing: border-box; }
html, body {
  margin: 0;
  height: 100%;
  background: #0f1115;
  color: #e6e6e6;
  font-family: system-ui, -apple-system, sans-serif;
}

/* ---------- APP ---------- */
.app {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

/* ---------- TOP BAR ---------- */
.topbar {
  min-height: 52px;
  padding: 0 14px;
  display: flex;
  align-items: center;
  gap: 10px;
  background: #171a21;
  border-bottom: 1px solid #222;
}

.brand {
  display: flex;
  align-items: center;
  gap: 10px;
  min-width: 0;
}

.brand img {
  width: 22px;
  height: 22px;
  display: block;
}

.title {
  font-weight: 700;
  letter-spacing: .2px;
  white-space: nowrap;
}

#gameLine {
  opacity: .85;
  font-size: 14px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.spacer { flex: 1; }

/* ---------- MAIN (MOBILE FIRST) ---------- */
.main {
  flex: 1;
  display: flex;
  flex-direction: column;
}

/* ---------- BOARD ---------- */
.board-wrap {
  padding: 12px;
}

#board {
  width: min(92vw, 560px); /* bigger board */
  margin: 0 auto;
}

/* ---------- CONTROLS ---------- */
.controls {
  padding: 0 12px 12px 12px;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.controls-row {
  display: flex;
  gap: 6px;
}

.controls button {
  flex: 1;
  padding: 10px 0;
  border: none;
  border-radius: 10px;
  background: #1f2430;
  color: #ddd;
  font-size: 16px;
}

.controls button:active {
  background: #2a3150;
}

/* Flip button under the second row */
#btnFlip {
  width: 100%;
}

/* ---------- MOVES ---------- */
.moves {
  padding: 12px;
  overflow-y: auto;
  line-height: 1.9;
  font-size: 15px;
  border-top: 1px solid #222;
}

.move {
  cursor: pointer;
  padding: 2px 4px;
  border-radius: 6px;
  display: inline-block;
}

.move:hover {
  background: #20263a;
}

.move.active {
  background: #3a7afe;
  color: #fff;
}

.nag {
  color: #ffcc00;
  margin-left: 2px;
}

.comment {
  display: none;
  margin: 4px 0 8px 16px;
  padding: 6px 8px;
  background: #1c2230;
  border-left: 3px solid #3a7afe;
  border-radius: 8px;
  font-size: 14px;
  color: #cfd6ff;
}

/* ---------- DESKTOP ---------- */
@media (min-width: 900px) {
  .main {
    display: grid;
    grid-template-columns: 560px 1fr; /* match bigger board */
    align-items: start;
  }
  .moves {
    border-top: none;
    border-left: 1px solid #222;
    min-height: calc(100vh - 52px);
  }
}
</style>
</head>

<body>

<div class="app">

  <div class="topbar">
    <div class="brand">
      <img src="https://jekyllchess.github.io/assets/favicon.png" alt="JekyllChess">
      <div class="title">JekyllChess PGN App</div>
    </div>
    <div class="spacer"></div>
    <div id="gameLine"></div>
  </div>

  <div class="main">
    <div>
      <div class="board-wrap">
        <div id="board"></div>
      </div>

      <div class="controls">
        <div class="controls-row">
          <button id="btnFirst" aria-label="First">⏮</button>
          <button id="btnPrev" aria-label="Previous">◀</button>
          <button id="btnPlay" aria-label="Play/Pause">▶</button>
          <button id="btnNext" aria-label="Next">▶</button>
          <button id="btnLast" aria-label="Last">⏭</button>
        </div>

        <div class="controls-row">
          <button id="btnFlip" aria-label="Flip board">↺ Flip board</button>
        </div>
      </div>
    </div>

    <div class="moves" id="moves"></div>
  </div>
</div>

<!-- PGN FROM FRONT-MATTER -->
<script id="pgn-data" type="application/json">
{{ page.pgn | jsonify }}
</script>

<script>
(() => {
  const pgn = JSON.parse(document.getElementById("pgn-data").textContent);

  const chess = new Chess();
  chess.load_pgn(pgn, { sloppy: true });

  const moves = chess.history({ verbose: true });
  chess.reset();

  const board = Chessboard("board", {
    position: "start",
    pieceTheme: "https://chessboardjs.com/img/chesspieces/wikipedia/{piece}.png"
  });

  // Elements
  const movesDiv = document.getElementById("moves");
  const gameLine = document.getElementById("gameLine");

  const btnFirst = document.getElementById("btnFirst");
  const btnPrev  = document.getElementById("btnPrev");
  const btnPlay  = document.getElementById("btnPlay");
  const btnNext  = document.getElementById("btnNext");
  const btnLast  = document.getElementById("btnLast");
  const btnFlip  = document.getElementById("btnFlip");

  // Header line (players)
  const h = chess.header();
  gameLine.textContent = `${h.White || ""} – ${h.Black || ""}`.trim();

  // Figurine SAN (very small, robust conversion)
  const FIG = { K:"♔", Q:"♕", R:"♖", B:"♗", N:"♘" };
  function sanToFigurine(san) {
    if (!san) return san;

    // Split trailing NAGs like "?!", "!!", "?!", etc.
    const nagMatch = san.match(/[!?]+$/);
    const nag = nagMatch ? nagMatch[0] : "";
    let core = nag ? san.slice(0, -nag.length) : san;

    // Replace leading piece letter with figurine
    core = core.replace(/^[KQRBN]/, ch => FIG[ch] || ch);

    // Replace promotion piece (e.g. e8=Q+)
    core = core.replace(/=([QRBN])/g, (_, p) => "=" + (FIG[p] || p));

    return { core, nag };
  }

  let index = -1;
  let autoplay = null;
  let orientation = "white";

  // Render moves
  moves.forEach((m, i) => {
    const moveSpan = document.createElement("span");
    moveSpan.className = "move";

    const { core, nag } = sanToFigurine(m.san);
    const moveNo = (m.color === "w") ? `${Math.floor(i / 2) + 1}. ` : "";
    const nagHtml = nag ? `<span class="nag">${nag}</span>` : "";

    moveSpan.innerHTML = `${moveNo}${core}${nagHtml} `;
    movesDiv.appendChild(moveSpan);

    let commentDiv = null;
    if (m.comment) {
      commentDiv = document.createElement("div");
      commentDiv.className = "comment";
      commentDiv.textContent = m.comment;
      movesDiv.appendChild(commentDiv);
    }

    moveSpan.onclick = () => {
      goto(i);
      if (commentDiv) {
        commentDiv.style.display = (commentDiv.style.display === "block") ? "none" : "block";
      }
    };
  });

  function highlight(i) {
    document.querySelectorAll(".move")
      .forEach((m, k) => m.classList.toggle("active", k === i));
  }

  function resetBoard() {
    chess.reset();
    board.position("start", true);
    index = -1;
    highlight(-1);
  }

  function goto(i) {
    chess.reset();
    for (let j = 0; j <= i; j++) chess.move(moves[j]);
    board.position(chess.fen(), true);
    index = i;
    highlight(i);
  }

  function stop() {
    clearInterval(autoplay);
    autoplay = null;
    btnPlay.textContent = "▶";
  }

  function next() {
    if (index < moves.length - 1) goto(index + 1);
    else stop();
  }

  // Controls
  btnFirst.onclick = resetBoard;
  btnPrev.onclick = () => (index > 0 ? goto(index - 1) : resetBoard());
  btnNext.onclick = next;
  btnLast.onclick = () => goto(moves.length - 1);

  btnPlay.onclick = () => {
    if (autoplay) return stop();
    btnPlay.textContent = "⏸";
    autoplay = setInterval(next, 500);
  };

  btnFlip.onclick = () => {
    orientation = (orientation === "white") ? "black" : "white";
    board.orientation(orientation);
  };

  // Make sure board follows CSS size changes (mobile/rotation)
  window.addEventListener("resize", () => board.resize());
})();
</script>

</body>
</html>
